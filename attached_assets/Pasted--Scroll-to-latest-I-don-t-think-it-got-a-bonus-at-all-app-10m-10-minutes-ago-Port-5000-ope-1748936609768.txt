

Scroll to latest
I don't think it got a bonus at all. 
/app

10m
 • 
10 minutes ago
Port :5000 opened on
Enable "Accessible Terminal" in Workspace Settings to use a screen reader with the shell.
Remote Updates
origin/250602-custom-position-search•upstream
last fetched 4 hours ago
7 commits to push
Commit
There are no changes to commit.
Selection deleted
                    totalCompanies={currentResults?.length || 0}
                    onClose={() => setSummaryVisible(false)}
                    isVisible={summaryVisible}
                  />
                </div>
              )}
              
              {/* Email Search Progress - with reduced padding */}
              {isConsolidatedSearching && (
                <div className="px-4 pt-0 pb-3">
                  <SearchProgress 
                    phase={searchProgress.phase}
                    completed={searchProgress.completed}
                    total={searchProgress.total}
                    isVisible={isConsolidatedSearching}
                  />
                </div>
              )}
              
              {/* Mini Search Menu */}
              {currentResults && currentResults.length > 0 && (
                <div className="px-6 pb-3 flex items-center gap-2">
                  <div className="relative">
                    <Button 
                      variant="outline" 
                      size="sm" 
                      className={`flex items-center gap-1 h-8 ${
                        highlightEmailButton 
                          ? 'email-button-highlight' 
                          : 'opacity-45 hover:opacity-100 hover:bg-white'
                      } transition-all`}
                      onClick={() => {
                        if (isFromLandingPage) {
                          setIsFromLandingPage(false);
                        }
                        runConsolidatedEmailSearch();
                      }}
                      disabled={isConsolidatedSearching}
                    >
                      <Mail className={`h-4 w-4 ${isConsolidatedSearching ? "animate-spin" : ""}`} />
                      <span>{isConsolidatedSearching ? "Searching..." : "Find Key Emails"}</span>
                    </Button>
                    
                    <LandingPageTooltip
                      message="Click here to find Egg-cellent emails of wonderful people."
                      visible={showEmailTooltip && !(isAnalyzing || isConsolidatedSearching)}
                      position="custom"
                      offsetX={-10}
                    />
                  </div>
                  
                  <TooltipProvider>
                    <Tooltip>
                      <TooltipTrigger asChild>
                        <Button 
                          variant="outline" 
                          size="sm" 
                          className={`flex items-center gap-1 h-8 ${
                            highlightStartSellingButton 
                              ? 'email-button-highlight' 
                              : 'opacity-45 hover:opacity-100 hover:bg-white'
                          } transition-all`}
                          onClick={handleStartSelling}
                        >
                          <Rocket className="h-4 w-4" />
                          <span>Start Selling</span>
                        </Button>
                      </TooltipTrigger>
                      <TooltipContent side="top">
                        <p className="text-xs">Save list, open "Outreach" page & load this list</p>
        {/* Main Search Summary */}
        <MainSearchSummary
          query={searchMetrics.query}
          totalCompanies={searchMetrics.totalCompanies}
          totalContacts={searchMetrics.totalContacts}
          searchDuration={searchMetrics.searchDuration}
          isVisible={summaryVisible}
          onClose={() => setSummaryVisible(false)}
          companies={searchMetrics.companies}
        />
        
        <div className="flex flex-col md:flex-row gap-2 pl-0">
          <Input
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            onKeyDown={(e) => {
              if (e.key === 'Enter' && !(isAnalyzing || quickSearchMutation.isPending || fullContactSearchMutation.isPending)) {
                e.preventDefault();
                handleSearch();
              }
            }}
            placeholder="Enter a search query (e.g., 'High-rated Greek restaurants in Midtown NYC')..."
            className={`flex-1 text-base md:text-lg text-gray-700 hover:border-gray-300 focus-visible:border-gray-400 ${isFromLandingPage ? 'racing-light-effect' : ''} ${showGradientText ? 'gradient-text-input' : ''}`}
          />
          <div className="flex items-center justify-end md:justify-start relative">

            
            {/* Component tooltip version for comparison */}
            <LandingPageTooltip
              message="If you are happy with this prompt, click search."
              visible={isFromLandingPage && !(isAnalyzing || quickSearchMutation.isPending || fullContactSearchMutation.isPending)}
              position="custom"
              offsetX={0}
              offsetY={-15}
            />
            
            {/* Enhanced search button with dynamic styling based on state */}
            <Button 
              type="submit"
              onClick={handleSearch} 
              disabled={isAnalyzing || quickSearchMutation.isPending || fullContactSearchMutation.isPending}
              className={`
                transition-all duration-300 flex items-center gap-2
                ${lastExecutedQuery && !inputHasChanged 
                  ? 'bg-gray-200 hover:bg-gray-300 dark:bg-gray-400 dark:hover:bg-gray-500 shadow-md hover:shadow-lg' 
                  : 'bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 shadow-md hover:shadow-lg'
                }
              `}
            >
              {(isAnalyzing || quickSearchMutation.isPending || fullContactSearchMutation.isPending) ? (
                <>
                  <Loader2 className="h-4 w-4 animate-spin" />
                  <span>Searching...</span>
                </>
              ) : (
                <>
                  <Search className="h-4 w-4" />
                  <span>Search</span>
                </>
              )}
            </Button>
            
            {/* Settings drawer trigger with custom search props */}
            <SearchSettingsDrawer 
              approaches={searchFlows as SearchApproach[]} 
              targetUrl={targetUrl}
              setTargetUrl={setTargetUrl}
              resultsUrl={resultsUrl}
              setResultsUrl={setResultsUrl}
              customSelected={customSelected}
              isCustomLoading={isCustomLoading}
              handleCustomWorkflowSearch={handleCustomWorkflowSearch}

            />
import type { Contact } from "@shared/schema";
import { validateRoleAffinity } from "./role-affinity-ai-scorer";

export interface CustomRoleAffinityOptions {
  customSearchTarget: string;
  enableCustomScoring: boolean;
}

const TIER_BONUSES = {
  1: 10, // Indirect affinity
  2: 15, // Close match  
  3: 20  // Exact/very close match
};

const DOWNGRADE_SCALE = [
  { min: 71, max: 75, downgradeTo: 71 },
  { min: 76, max: 80, downgradeTo: 72 },
  { min: 81, max: 85, downgradeTo: 73 },
  { min: 86, max: 90, downgradeTo: 74 }
];

const AFFINITY_THRESHOLD_MINIMUM = 70;

export async function applyCustomRoleAffinityScoring(
  contacts: Contact[],
  options: CustomRoleAffinityOptions
): Promise<Contact[]> {
  
  if (!options.enableCustomScoring || !options.customSearchTarget) {
    return contacts;
  }

  console.log(`Applying AI-based custom role affinity scoring for target: "${options.customSearchTarget}"`);

  // Extract unique roles for bulk AI validation
  const contactsWithRoles = contacts.filter(c => c.role);
  const uniqueRoles = Array.from(new Set(contactsWithRoles.map(c => c.role!)));
  
  if (uniqueRoles.length === 0) {
    console.log('No contacts with roles found, skipping custom scoring');
    return contacts;
  }

  // Get AI tier scores
  const aiTierScores = await validateRoleAffinity(
    uniqueRoles,
    options.customSearchTarget
  );

  return contacts.map(contact => {
    const originalScore = contact.probability || 0;
    let adjustedScore = originalScore;
    
    // Apply downgrade scale first
}
