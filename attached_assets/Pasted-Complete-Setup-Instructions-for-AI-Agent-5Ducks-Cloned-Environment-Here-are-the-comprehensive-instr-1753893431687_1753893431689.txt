Complete Setup Instructions for AI Agent: 5Ducks Cloned Environment
Here are the comprehensive instructions you can provide to an AI agent working with a fresh clone:

1. Hybrid Database Architecture Explanation
Two-Database System Overview
5Ducks uses a strategic separation of data storage:

PostgreSQL Database (Primary) - Complex relational data:

Tables: users, lists, companies, contacts, strategic_profiles, user_preferences, email_templates, onboarding_chats
Purpose: Search results, user profiles, business strategies, email templates
Access: Via Drizzle ORM through storage abstraction layer
Control: Managed by storage switcher (storage-switching/1--storage-switcher.ts)
Replit Key-Value Database (Secondary) - Simple key-value data:

Data: User credits (user_credits:{userId}), Gmail OAuth tokens (gmail_tokens:{userId})
Purpose: Credits/billing, authentication tokens
Access: Direct @replit/database imports in service classes
Lifecycle: Auto-provisioned by Replit, no setup required
Why This Architecture?
PostgreSQL: Handles complex queries, relationships, transactions
Key-Value: Fast access for simple data, automatic Replit integration
Clean separation: Credits/tokens don't need relational complexity
Performance: Each database optimized for its data type
Storage Flow
User Search → PostgreSQL (companies, contacts, lists)
User Credits → Replit KV (credit_service)
Gmail Auth → Replit KV (token_service)
User Profiles → PostgreSQL (users, preferences)
2. PostgreSQL Database Setup Instructions
Step 1: Provision PostgreSQL
# In Replit: Storage tab → PostgreSQL → Create Database
# This automatically creates DATABASE_URL secret
Step 2: Create All Database Tables
Important: The npm run db:push command doesn't work due to Drizzle config issues. Use manual SQL setup:

-- Create all 8 required tables in exact order (foreign key dependencies):
-- 1. Users table (foundation for all foreign keys)
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
-- 2. User preferences table
CREATE TABLE user_preferences (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
-- 3. Lists table
CREATE TABLE lists (
  id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  list_id INTEGER NOT NULL,
  prompt TEXT NOT NULL,
  result_count INTEGER NOT NULL,
  custom_search_targets JSONB DEFAULT '[]',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
CREATE INDEX idx_lists_user_id ON lists(user_id);
CREATE INDEX idx_lists_list_id ON lists(list_id);
-- 4. Companies table  
CREATE TABLE companies (
  id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  name TEXT NOT NULL,
  list_id INTEGER,
  description TEXT,
  age INTEGER,
  size INTEGER,
  website TEXT,
  alternative_profile_url TEXT,
  default_contact_email TEXT,
  website_ranking INTEGER,
  linkedin_prominence INTEGER,
  customer_count INTEGER,
  rating INTEGER,
  services JSONB DEFAULT '[]',
  validation_points JSONB DEFAULT '[]',
  differentiation JSONB DEFAULT '[]',
  total_score INTEGER,
  snapshot JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
CREATE INDEX idx_companies_user_id ON companies(user_id);
CREATE INDEX idx_companies_list_id ON companies(list_id);
CREATE INDEX idx_companies_name ON companies(name);
-- 5. Contacts table
CREATE TABLE contacts (
  id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  company_id INTEGER NOT NULL,
  name TEXT NOT NULL,
  role TEXT,
  email TEXT,
  alternative_emails JSONB DEFAULT '[]',
  probability INTEGER,
  linkedin_url TEXT,
  twitter_handle TEXT,
  phone_number TEXT,
  department TEXT,
  location TEXT,
  verification_source TEXT,
  last_enriched TIMESTAMP WITH TIME ZONE,
  name_confidence_score INTEGER,
  user_feedback_score INTEGER,
  feedback_count INTEGER DEFAULT 0,
  last_validated TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  completed_searches JSONB DEFAULT '[]'
);
CREATE INDEX idx_contacts_company_id ON contacts(company_id);
CREATE INDEX idx_contacts_user_id ON contacts(user_id);
CREATE INDEX idx_contacts_email ON contacts(email);
-- 6. Email templates table
CREATE TABLE email_templates (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  name TEXT NOT NULL,
  subject TEXT NOT NULL,
  content TEXT NOT NULL,
  description TEXT,
  category TEXT DEFAULT 'general',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
-- 7. Strategic profiles table (CRITICAL - All 27 columns required)
CREATE TABLE strategic_profiles (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  business_type TEXT NOT NULL,
  business_description TEXT NOT NULL,
  unique_attributes TEXT[],
  target_customers TEXT NOT NULL,
  market_niche TEXT,
  product_service TEXT,
  customer_feedback TEXT,
  website TEXT,
  business_location TEXT,
  primary_customer_type TEXT,
  primary_sales_channel TEXT,
  primary_business_goal TEXT,
  strategy_high_level_boundary TEXT,
  example_sprint_planning_prompt TEXT,
  example_daily_search_query TEXT,
  product_analysis_summary TEXT,
  report_sales_context_guidance TEXT,
  report_sales_targeting_guidance TEXT,
  daily_search_queries TEXT,
  strategic_plan JSONB DEFAULT '{}',
  search_prompts TEXT[],
  status TEXT DEFAULT 'in_progress',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
-- 8. Onboarding chats table
CREATE TABLE onboarding_chats (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  profile_id INTEGER NOT NULL REFERENCES strategic_profiles(id),
  messages JSONB DEFAULT '[]',
  current_step TEXT DEFAULT 'business_description',
  is_complete BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
Step 3: Setup Demo Data (Single Command)
tsx scripts/setup-demo-data.ts
This creates:

Demo user (ID: 1) for non-registered user functionality
4 professional email templates with merge fields
Handles existing data gracefully
Step 4: Verify Setup
Test these features:

Strategy page loads without errors
Search functionality saves results
Non-registered users can access searches (user ID: 1)
Email templates appear in Quick Templates section
Complete search → contacts → emails workflow
3. Storage Switcher Configuration
Verify PostgreSQL is active:

// In storage-switching/1--storage-switcher.ts
const USE_REPLIT_DB = false; // Should be false for PostgreSQL
Key Services Still Use Replit KV:

server/lib/credits/index.ts - Credit management
server/lib/tokens/index.ts - Gmail OAuth tokens
4. Troubleshooting
Common Issues:

"column does not exist" → strategic_profiles table missing columns
Foreign key violations → Tables created in wrong order
Demo user missing → Non-registered users can't save searches
No email templates → Outreach system appears empty
Quick Fixes:

Rerun demo data script: tsx scripts/setup-demo-data.ts
Check table structure: \d strategic_profiles in psql
Verify storage switcher: USE_REPLIT_DB = false
This hybrid architecture provides the best of both worlds: robust relational data management through PostgreSQL and simple key-value operations through Replit's integrated database system.

