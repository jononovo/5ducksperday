5Ducks Complete Setup Instructions for AI Agent
Quick Overview
5Ducks uses a hybrid storage architecture:
* PostgreSQL: Business data (users, companies, contacts, lists, email templates, strategic profiles)
* Replit Key-Value DB: User services (credits, Gmail tokens, notifications, subscriptions)
Step-by-Step Setup
1. Provision PostgreSQL Database
# In Replit: Storage tab → PostgreSQL → Create Database
# This automatically sets DATABASE_URL environment variable

2. Create Database Schema (Method 1 - Recommended)
# Use direct Drizzle CLI command (works reliably)
npx drizzle-kit push --url "$DATABASE_URL" --schema "./shared/schema.ts" --dialect postgresql

Alternative Method 2 (if above fails):
# The npm script references a missing config file, but sometimes works
npm run db:push

3. Setup Demo Data & Default Templates
# Creates demo user (ID: 1) and 4 professional email templates
npx tsx scripts/setup-demo-data.ts

4. Verify Setup
The system should now have:
* ✅ 8 PostgreSQL tables: users, lists, companies, contacts, email_templates, user_preferences, strategic_profiles, onboarding_chats
* ✅ Demo user (ID: 1) for non-registered users
* ✅ 4 email templates for outreach system
* ✅ Hybrid storage properly configured
Architecture Verification
PostgreSQL Tables Created:
1. users - User accounts (includes is_guest column)
2. lists - Search result lists
3. companies - Company records with full metadata
4. contacts - Contact records with email enrichment data
5. email_templates - Professional email templates with merge fields
6. user_preferences - User settings
7. strategic_profiles - Business strategy data (27+ columns)
8. onboarding_chats - Strategy chat conversations
Key-Value Storage (Automatic):
* Credits: user_credits:{userId} - Managed by CreditService
* Gmail Tokens: user_tokens:{userId} - Managed by TokenService
* Notifications, Subscriptions, Badges - Various service keys
Storage Configuration:
// storage-switching/1--storage-switcher.ts
const USE_REPLIT_DB = false; // ✅ Should be false for PostgreSQL

Testing Your Setup
1. Basic Functionality Test:
* Visit /app - should load without database errors
* Try a search - should save companies/contacts to PostgreSQL
* Visit /outreach - should show 4 email templates in Quick Templates
* Visit /strategy - should load strategy dashboard
2. Non-Registered User Test:
* Open private/incognito window
* Visit landing page, enter search query
* Should redirect to /app and execute search using demo user (ID: 1)
3. Authentication Test:
* Register new account - should create PostgreSQL user record
* Login/logout - should maintain session properly
* Check credits system - should show welcome bonus
Key Service Files
Database Services:
* server/1--storage/database.ts - PostgreSQL operations
* server/lib/credits/index.ts - Credit management (Key-Value)
* server/lib/tokens/index.ts - Gmail token management (Key-Value)
Schema & Types:
* shared/schema.ts - Complete PostgreSQL schema with all tables
* All insert schemas and TypeScript types are defined
Troubleshooting
"Column does not exist" Errors:
# Re-run schema push
npx drizzle-kit push --url "$DATABASE_URL" --schema "./shared/schema.ts" --dialect postgresql

Missing Demo Data:
# Re-run demo setup
npx tsx scripts/setup-demo-data.ts

Drizzle Config Issues:
# Skip npm run db:push, use direct CLI instead
# The drizzle.config.json was removed due to environment variable resolution issues

Storage Architecture Issues:
// Verify in storage-switching/1--storage-switcher.ts
const USE_REPLIT_DB = false; // Must be false for PostgreSQL

Working Features After Setup
✅ Complete Search Flow: Landing → App → Company Discovery → Contact Enrichment → Email Finding ✅ Email Templates: 4 professional templates with merge fields ({{company_name}}, {{contact_name}}, etc.) ✅ Strategy System: Business strategy creation and management ✅ Credit System: 250 welcome credits, proper deduction, upgrade prompts ✅ Gmail Integration: OAuth token management for email sending ✅ Non-Registered Users: Full functionality using demo user (ID: 1) ✅ Session Management: Persistent authentication with Firebase
Architecture Benefits
* Performance: PostgreSQL for complex queries, Key-Value for simple operations
* Scalability: Proper indexing and relationships in PostgreSQL
* Reliability: Replit-managed Key-Value storage for critical user services
* Development: Clean separation allows focused optimization of each storage type
This hybrid approach provides enterprise-grade data management while maintaining the simplicity of key-value operations for user services.
