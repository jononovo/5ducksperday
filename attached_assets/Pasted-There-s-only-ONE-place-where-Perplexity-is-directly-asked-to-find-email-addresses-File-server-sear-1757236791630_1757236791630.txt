There'sÂ only ONE placeÂ where Perplexity is directly asked to find email addresses:
File:Â server/search/enrichment/contact-details.tsâ€¨Function:Â searchContactDetailsÂ (lines 35-60)
const messages: PerplexityMessage[] = [
{
role: "system",
content: `You are a contact information researcher. Find professional information about the specified person. Include:
1. Role and department
2. Professional email // <-- HERE: Requesting email
3. LinkedIn URL
4. Location

IMPORTANT: If you cannot find data, leave fields empty. Do NOT make up data.

Format your response as JSON.`
},
{
role: "user",
content: `Find professional contact information for ${name} at ${company}.`
}
];

ğŸ”—Â How It's Called
This function is exposed throughÂ three API endpoints:
1. /api/contacts/:contactId/enrichÂ (Primary endpoint)
    * File:Â server/search/contacts.tsÂ (line 124)
    * Used by the "AI-powered Search" button in the UI (Sparkles icon)
    * Called when users click the dropdown menu item
2. /api/contacts/searchÂ (Direct search)
    * File:Â server/search/contacts.tsÂ (line 94)
    * Takes name and company as body parameters
    * Less commonly used
3. Comprehensive Email SearchÂ (Orchestrated)
    * File:Â client/src/hooks/use-comprehensive-email-search.tsÂ (line 84)
    * Calls the enrich endpoint as part of a multi-provider search sequence
    * Order: Apollo â†’Â PerplexityÂ â†’ Hunter
ğŸ¯Â Frontend Usage
The Perplexity email search is triggered from:
1. Search PageÂ (client/src/pages/home.tsx)
    * ViaÂ handleEnrichContactÂ function (line 1144)
    * Through the contact action dropdown menu
2. Outreach PageÂ (client/src/pages/outreach.tsx)
    * ViaÂ handleEnrichContactÂ function (line 1019)
    * Same dropdown menu component
3. Contact Action DropdownÂ (client/src/components/contact-action-column.tsx)
    * Shows as "AI-powered Search" with Sparkles icon
    * Lines 129-145
ğŸ“ŠÂ Summary
You're correct - thereÂ aren't manyÂ Perplexity prompts requesting email addresses. In fact, there'sÂ only ONE prompt templateÂ in the entire codebase that explicitly asks Perplexity for email addresses. This single prompt is reused across all contact enrichment scenarios.
The prompt is straightforward and asks for "Professional email" as one of four data points (role, email, LinkedIn, location). This makes it easy to modify or remove if needed.
The comprehensive email search feature uses this as a fallback - it tries Apollo first, then Perplexity, then Hunter.io as a last resort to find email addresses.

3 minutes of work

OK, so within this Perplexity enrichment request there's actually a few different things that are being received back and I'm not sure how often they're actually being received but I don't think anything other than the email address is actually being safe to the database and into the contactâ€™s page on the app. Right?â€¨â€¨What I would like is to map the other elements that are being discovered ( and I'm sure sometime soon not included or found) two database fields for that specific contact.â€¨â€¨And I'm not sure if we have these fields ready for contacts or if we may need to create them.â€¨â€¨What do you think?â€¨â€¨I mean, I know we have role and department.â€¨And we have professional email.â€¨But I don't think we're saving LinkedIn or location anywhere right?â€¨â€¨Also, we're already doing a separate request for the designation of the contact so maybe we can remove that from the request as it's a bit of duplication isn't it?â€¨â€¨â€¨â€”â€¨â€¨const messages: PerplexityMessage[] = [â€¨{â€¨role: "system",â€¨content: `You are a contact information researcher. Find professional information about the specified person. Include:â€¨1. Role and departmentâ€¨2. Professional email // <-- HERE: Requesting emailâ€¨3. LinkedIn URLâ€¨4. Location
IMPORTANT: If you cannot find data, leave fields empty. Do NOT make up data.

Format your response as JSON.`

},â€¨{â€¨role: "user",â€¨content:Â Find professional contact information for ${name} at ${company}.â€¨}â€¨];



6 minutes ago

Optimized Agent memory

Planned Perplexity field mapping (6 seconds)

You're absolutely right! Let me investigate the current state of contact data storage and the Perplexity enrichment handling.

OpenedÂ server/search/analysis/email-analysis.ts


Decided on parsing logic adjustment (6 seconds)

Excellent observation! You're absolutely correct. After investigating the code, I found the issue:
ğŸ”Â Current Problem
TheÂ good news: The database already has all the necessary fields:
* linkedinUrlÂ âœ…
* locationÂ âœ…
* roleÂ âœ…
* departmentÂ âœ…
TheÂ bad news: TheÂ parseEmailDetailsÂ function inÂ server/search/analysis/email-analysis.tsÂ isÂ ONLY extracting email addressesÂ from Perplexity's response. It completely ignores LinkedIn URL, location, role, and department!
Here's what's happening:
1. Perplexity returns a JSON response with all 4 fields
2. TheÂ parseEmailDetailsÂ function only looks for email patterns with regex
3. All other valuable data (LinkedIn, location, etc.) is thrown away ğŸ˜
4. The endpoint tries to save these fields but they're always undefined
ğŸ“‹Â Solution Plan
Let me fix this by:
1. Updating theÂ parseEmailDetailsÂ function to properly parse JSON and extract ALL fields
2. Optionally removing role/department from the request (as you suggested, since it might be redundant)
3. Ensuring all discovered data is saved to the database


