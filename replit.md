# 5Ducks B2B Prospecting Application

## Overview

5Ducks is a comprehensive B2B lead generation and prospecting platform designed to help small businesses "sell to 5 new people every day." The application combines AI-powered company search, contact discovery, email enrichment, and campaign management into a unified platform. Built with React frontend and Express/Node.js backend, it uses Replit Database for data persistence and integrates with multiple third-party APIs for contact discovery and validation.

## System Architecture

### Frontend Architecture
- **React SPA** with TypeScript for type safety
- **Vite** for development and build tooling
- **Tailwind CSS** with shadcn/ui component library for styling
- **TanStack Query** for server state management
- **React Router** for client-side routing
- **Radix UI** components for accessible UI primitives

### Backend Architecture
- **Express.js** server with TypeScript
- **Replit Database** for data persistence with simple key-value operations
- **Passport.js** for authentication with Firebase Auth integration
- **Modular API design** with separate route handlers and business logic

### Database Design
- **Replit Database** for simple key-value data storage
- **Schema validation** using Zod for data integrity
- **Storage abstraction layer** with IStorage interface for consistent data operations

## Key Components

### Search & Discovery System
- **Multi-stage search process**: Company discovery ‚Üí Contact extraction ‚Üí Email enrichment
- **AI-powered analysis** using Perplexity API for company intelligence
- **Modular search architecture** with pluggable search modules
- **Enhanced search orchestrator** with retry logic and error handling
- **Real-time search status tracking** with webhook integration

### Contact Management
- **Intelligent contact discovery** with confidence scoring
- **Email validation and enrichment** through multiple providers (Hunter.io, Apollo.io, AeroLeads)
- **Contact ranking system** based on role importance and validation scores
- **Post-search enrichment queue** for background processing

### Email & Campaign System
- **Template-based email campaigns** with personalization
- **Multi-provider email integration** (Gmail, mock providers)
- **Thread-based conversation tracking**
- **Campaign performance analytics**

### Authentication & User Management
- **Firebase Authentication** for secure user login
- **Session-based authentication** with Passport.js
- **User preferences and settings management**
- **Multi-tenant architecture** with user isolation

## Data Flow

### Primary Search Flow
1. **User Input**: Search query entered on landing or main application page
2. **Company Discovery**: Perplexity API searches for matching companies
3. **Company Analysis**: Each company analyzed for size, services, and market position
4. **Contact Extraction**: AI extracts key decision makers from company information
5. **Email Discovery**: Multiple APIs (Hunter, Apollo, AeroLeads) search for contact emails
6. **Validation & Scoring**: Contacts validated and scored for relevance
7. **Results Display**: Companies displayed in expandable table with top 3 contacts each

### Background Processing
- **Post-search enrichment queue** processes additional contact validation
- **Webhook system** handles external workflow integration (N8N)
- **Search session management** maintains state across long-running searches

## External Dependencies

### Core APIs
- **Perplexity API**: Company research and contact discovery
- **OpenAI API**: Email strategy generation and content creation
- **Hunter.io API**: Email finder and verification
- **Apollo.io API**: Professional contact database
- **AeroLeads API**: Email discovery service

### Infrastructure
- **Firebase**: Authentication and user management
- **Replit Database**: Primary data storage
- **N8N Workflows**: External automation integration
- **Google APIs**: Gmail integration for email campaigns

### Development Tools
- **Vite**: Frontend build tool and dev server
- **ESBuild**: Backend bundling for production

## Deployment Strategy

### Development Environment
- **Replit-optimized**: Configured for Replit's development environment
- **Hot reloading**: Vite provides instant frontend updates
- **Database provisioning**: Automatic Replit Database setup
- **Port configuration**: Frontend (3000) and backend (5000) ports configured

### Production Deployment
- **Google Cloud Run**: Containerized deployment target
- **Build process**: Vite builds static assets, ESBuild bundles backend
- **Environment variables**: Replit Database access and API keys via environment
- **Workflow integration**: N8N webhooks for external automation

### Storage Strategy
- **Replit Database**: Primary data persistence layer
- **Storage abstraction**: IStorage interface provides consistent data operations
- **Key-value operations**: Optimized for Replit's native database system

## Changelog
- June 13, 2025. Initial setup
- June 13, 2025. Mobile UI optimizations: Fixed duck header positioning (-mt-1), reduced email form horizontal padding (p-6‚Üípx-3 py-6 md:p-6) for 24px wider mobile inputs, updated "Save Template" to "Save as Template", and removed chevron arrow from mobile duck header navigation button
- June 13, 2025. Edge-to-edge mobile input layout: Implemented Gmail-style mobile input fields with zero horizontal margins (px-0), added border separators between fields, and maintained desktop spacing while maximizing mobile typing space
- June 13, 2025. Mobile input visual enhancements: Added subtle bluish background colors to mobile inputs with darker shade on focus/active states, replacing border highlighting with smooth background transitions for better edge-to-edge design consistency
- June 13, 2025. Clean CSS architecture: Removed !important hacks and properly overrode shadcn focus styling using focus-visible:ring-0 and focus-visible:ring-offset-0 Tailwind classes. Added consistent left padding (px-3) to generate email and email content fields for better text positioning
- June 13, 2025. Contact navigation UX improvement: Added ChevronRight icon to mobile contact toggle button (showing contact count like "2/3") to provide visual indication of interactivity without changing button behavior
- June 13, 2025. Navigation consistency: Added ChevronRight icons to both mobile navigation buttons - contact button with standard styling and company button with lighter gray (text-muted-foreground/50) to match existing visual hierarchy
- June 13, 2025. Button design updates: Made Save as Template and Send Email buttons smaller to match Generate Email button size (h-8 px-3 text-xs), and changed Send Email button to white background with black border and text for clean minimal styling
- June 13, 2025. Simplified Send Email button hover: Clean color reversal hover effect (white‚Üíblack background, black‚Üíwhite text) with 105% scaling and smooth 300ms transitions
- June 13, 2025. Consistent button hover animations: Added 105% scaling hover effect with smooth 300ms transitions to Generate Email and Save as Template buttons, maintaining their original colors while providing unified interaction feedback
- June 13, 2025. New Template button standardization: Made "New Template" button smaller (h-8 px-3 text-xs) to match other action buttons and added the same 105% scaling hover effect with smooth transitions
- June 14, 2025. iOS Safari auto-zoom prevention: Added mobile-input-text-fix CSS class (16px font-size on mobile, 14px on desktop) to all outreach page input fields to prevent automatic zoom behavior while preserving design on larger screens
- June 14, 2025. Simplified email prompt placeholder: Removed "Example:" prefix from email prompt field placeholder text, changing from "Example: Sell dog-grooming services" to "Sell dog-grooming services" for cleaner UX
- June 14, 2025. Inline email body buttons: Moved "Save as Template" and "Send Email" buttons inside the email body textarea field using absolute positioning, matching the Generate Email button pattern for consistent UI design
- June 14, 2025. Relocated Save as Template button: Moved "Save as Template" button from email body field to Quick Templates section header, positioned next to "New Template" button for better organization and cleaner email body interface
- June 14, 2025. Complete inline merge system for Create Template dialog: Added "Merge" dropdown buttons to all three fields (Email Subject, Description/Prompt, Email Body) with predefined merge variables ({{company_name}}, {{contact_name}}, {{contact_role}}, {{sender_name}}). Implemented consistent positioning using relative containers with absolute bottom-2 right-2 button placement and pb-10/pb-12 padding for proper text spacing
- June 14, 2025. Comprehensive merge field dialog system: Created dedicated MergeFieldDialog component with 13 merge variables, responsive design (full-page mobile, standard desktop), copy-to-clipboard functionality with visual feedback, and auto-close after 1 second. Added "Merge Field" button to Quick Templates header for easy access across the application
- June 14, 2025. Removed Create Template Dialog: Eliminated 350+ lines of duplicated code by removing CreateTemplateModal component and all related functionality. Template creation now streamlined through outreach page "Save as Template" workflow only, reducing code complexity and improving user experience
- June 14, 2025. Button size standardization: Updated "Insert Template" button to match smaller sizing (h-8 px-3 text-xs), consistent hover animation (scale-105), content-based width (removed w-full), right alignment (justify-end), secondary variant styling, right margin (mr-2), FileText icon, and restored disabled state when no template selected for proper UX feedback in Quick Templates section
- June 14, 2025. Edit Template functionality: Added "Edit Template" button next to "Insert Template" with Edit icon, same disabled logic when no template selected, and confirmation dialog warning "Editing this template, will replace all content currently in fields on this page" with Cancel/Load Template options using shadcn AlertDialog components
- June 14, 2025. Complete merge field insertion system: Implemented clickable merge field functionality with React refs for all form inputs (email prompt, subject, content, recipient), cursor position handling, and MergeFieldDialog integration that inserts merge variables directly at cursor position instead of clipboard copy
- June 14, 2025. Mobile navigation spacing optimization: Refined company button spacing with mr-0.5 between Building2 icon and "7/7" text for better readability, while maintaining gap-0 base spacing and tight chevron positioning. Contacts button remains with uniform gap-0 spacing throughout
- June 14, 2025. Clean templates section layout: Removed "Quick Templates" heading and added pt-6 padding above templates section for better visual separation from email body input. Right-aligned action buttons (Merge Field, Save as Template) for cleaner interface design
- June 14, 2025. Unified margin strategy implementation: Applied consistent mr-2 margin pattern (matching Save as Template button) to template dropdown SelectTrigger and both Insert/Edit Template buttons for reliable mobile spacing and visual consistency
- June 14, 2025. Insert Template confirmation dialog: Added confirmation dialog to "Insert Template" button matching Edit Template pattern, with title "Load Template" and warning "Loading this template, will replace all content currently in fields on this page" for consistent user protection against data loss
- June 14, 2025. Complete template edit mode system: Implemented comprehensive template editing with mode switching (Edit Template ‚Üî Save Template), red "Edit Template Mode" notification banner, content resolution showing handlebars vs resolved merge fields based on mode, and full backend support with PUT endpoint and storage methods for seamless same-page template editing and preview
- June 14, 2025. Template name preservation fix: Resolved critical bug where template updates were hardcoded to "Updated Template" name. Added editingTemplate state to store complete template object during editing, ensuring original template names are preserved during updates while allowing content modifications
- June 14, 2025. Merge field highlighting removal: Completely removed all merge field highlighting functionality including overlay components, context providers, and enhanced input components. Reverted to standard Input and Textarea components for cleaner, simpler form handling without visual highlighting complexity
- June 14, 2025. Complete merge view toggle system: Implemented toggle between "Merge View" (showing technical syntax like {{company_name}}) and "Normal View" (showing resolved values like "Boston Centerless"). Added isMergeViewMode state to outreach page, updated getDisplayValue and content resolution functions to consider merge view mode, button toggles between "Merge View"/"Normal View" labels with EyeOff icon, and added blue notification banner in Quick Templates section for clear visual feedback
- June 14, 2025. Merge Fields Dialog copy icon fix: Separated clipboard functionality from direct insertion logic. Created dedicated handleCopyToClipboard function that always copies merge fields (with handlebars) to clipboard, while handleFieldSelect remains for direct form insertion. Copy icon now properly copies to clipboard with green checkmark feedback, following existing codebase patterns
- June 14, 2025. Merge Fields Dialog unified copy behavior: Reverted row insertion logic to use clipboard functionality instead. Both row clicks and copy icon clicks now perform identical actions - copy merge field to clipboard, show green checkmark feedback, and auto-close dialog after 0.8 seconds. Removed event propagation conflicts since both actions are now unified
- June 15, 2025. Dual storage merge field system: Implemented comprehensive solution for merge field conversion issue in email body by storing both original (merge field syntax) and resolved (actual values) versions of content. Added originalEmailPrompt, originalEmailContent, and originalEmailSubject state variables, updated getDisplayValue function to use dual storage, modified template loading and AI generation to preserve merge fields, and enhanced localStorage persistence to maintain both versions for reliable merge view toggle functionality
- June 15, 2025. Template dropdown cleanup: Removed FileText icons from template dropdown SelectItems and simplified template display to show only template names instead of complex nested structure with descriptions. Fixed excessive left indentation by changing SelectItem padding from pl-8 (32px) to pl-3 (12px) and removed unnecessary mr-2 margin from SelectTrigger for cleaner, better-aligned template selection interface
- June 15, 2025. Duck header scroll compression: Implemented smooth scroll-triggered compression effect for mobile duck emoji header. Added scroll listener that immediately triggers when user scrolls (window.scrollY > 0), reducing emoji font sizes (üê•: text-2xl‚Üítext-lg, ü•ö: text-lg‚Üítext-sm), compressing padding (pt-2 pb-1‚Üípt-1 pb-0.5), and shrinking close button (w-5 h-5‚Üíw-4 h-4, p-1‚Üíp-0.5). Header maintains fixed positioning to overlay main navigation. All transitions use 300ms duration for smooth animation
- June 15, 2025. Button row spacing improvement: Added mb-6 (24px bottom margin) to Quick Templates button row containing "Merge View", "Merge Field", and "Save as Template" buttons for better visual separation from template dropdown section
- June 15, 2025. Email textarea auto-resize fix: Corrected ref mismatch in handleTextareaResize function by changing textareaRef.current to emailContentRef.current. Email body now properly expands from 160px minimum to 400px maximum height before becoming scrollable. Removed unused textareaRef declaration
- June 15, 2025. Mini footer simplification: Removed copyright text, reduced font size from text-sm to text-xs, and cut height in half by changing padding from py-4 to py-2. Footer now shows only "Soli Deo Gloria" and "LinkedIn" link with minimal footprint
- June 15, 2025. Contact search chips default optimization: Changed default configuration to enable only Core Leadership by default, while Department Heads and Middle Management start disabled. This focuses searches on C-level executives and founders by default, allowing users to manually expand scope as needed. Applied to both initial state and localStorage fallback configuration
- June 15, 2025. Search settings icon repositioning: Moved search settings icon from main search bar to lower right corner with absolute positioning (bottom-8 right-4). Made icon less prominent with 40% opacity, gray coloring, and smaller size (h-4 w-4). Icon remains fully functional but now sits discretely out of the main interface flow
- June 15, 2025. Mobile contact chips spacing optimization: Eliminated vertical spacing between search bar and contact chips on mobile screens by changing container gap from gap-2 to gap-0 md:gap-2. Creates seamless connection on narrow screens while maintaining proper spacing on desktop
- June 15, 2025. Mobile search input optimization: Repositioned search type selector from inside input field to below search button on mobile screens. Changed input padding from pr-20 to md:pr-20 pr-4 for maximum mobile typing space. Created responsive layout where contact chips and search selector share same row on mobile (justify-between) while maintaining separate rows on desktop. Preserves all functionality while maximizing mobile usability
- June 15, 2025. Mobile search type selector alignment fix: Changed mobile container alignment from items-center to items-start to prevent search type selector from jumping down when contact chips expand to multiple rows. Selector now stays anchored to top position for consistent user experience
- June 15, 2025. Mobile search type selector spacing fix: Added mt-5 top margin to search type selector wrapper for optimal spacing. Selector positioned with generous distance from search button above for clean visual hierarchy
- June 15, 2025. Connected mobile search interface: Removed gap between search input and button on mobile (md:gap-2 gap-0), implemented seamless connection with custom border radius (input: rounded-l-md rounded-r-none, button: rounded-l-none rounded-r-md). Creates unified search element on mobile while preserving separate elements on desktop for maximum input width
- June 15, 2025. Mobile padding optimization: Reduced horizontal padding across mobile interface - main container (px-2 md:px-6), search section (px-3 md:px-6), grid gaps (gap-3 md:gap-6), and section spacing (space-y-2 md:space-y-4). Creates tighter, more space-efficient mobile layout while maintaining desktop comfort
- June 15, 2025. Search placeholder text update: Changed search input placeholder from example-based text to encouraging message "Be as detailed as possible üéØ üòâ" to prompt users for more detailed queries and better search results
- June 15, 2025. Mobile focus enhancement: Implemented mobile-only input focus animation with 3% width expansion (scaleX(1.03)) and internal blue border highlight. Uses CSS transitions for smooth animation and gently pushes search button right when input is active, solving the disjointed outline issue from connected interface
- June 15, 2025. Mobile focus enhancement fixes: Replaced scaleX transform with flex-grow expansion (1 to 1.03) to properly push search button right instead of overlapping. Added comprehensive focus-visible overrides with !important declarations to eliminate shadcn's default dark border/ring styling on mobile, ensuring only internal blue border appears
- June 15, 2025. Mobile focus styling refinement: Removed problematic width expansion approaches and simplified to clean internal border only. Changed border from thick blue (2px, rgba(59, 130, 246, 0.4)) to thin light gray (1px, rgba(156, 163, 175, 0.3)) for subtle, professional focus indication on mobile devices
- June 15, 2025. Search placeholder text refinement: Removed winking emoji from placeholder text, changing from "Be as detailed as possible üéØ üòâ" to "Be as detailed as possible üéØ" for cleaner, more professional appearance
- June 15, 2025. Search placeholder example update: Changed placeholder from motivational text to concrete example "Series-A Fintech companies in NYC " to demonstrate the specificity level and search format that works best with the B2B prospecting system
- June 15, 2025. Mobile button label optimization: Hidden text labels on mobile for "Start Selling", "5 More", and "Expand" buttons using `hidden md:inline` classes while preserving icons and desktop functionality. "Find Key Emails" button retains full text on all screen sizes for clarity
- June 15, 2025. Clean search interface optimization: Hide entire header container (emoji animation + "Search for target businesses" heading) when search results are present using conditional rendering (!currentResults). Saves ~60-80px vertical space and creates cleaner, more focused results interface while preserving welcoming introduction for new users
- June 15, 2025. Saved searches drawer button repositioning: Moved button from top-20 to top-32 on mobile (md:top-20 preserves desktop position) to prevent overlap with search input. Made button more compact on mobile (h-8 w-8 vs h-10 w-10 desktop) and scaled down ListChecks icon (h-4 w-4 vs h-5 w-5 desktop) for better mobile space efficiency
- June 15, 2025. Replies menu item hidden: Commented out "Replies" navigation item in main-nav.tsx navigation array to hide the unfinished feature while preserving code for future re-enablement
- June 15, 2025. Hamburger menu button border removal: Changed main navigation dropdown menu button from variant="outline" to variant="ghost" to remove border while preserving hover effects and background states
- June 15, 2025. Landing page example text update: Changed suggestion button from "Wolf-of-wallstreet-esque trading companies" to "Series-A Fintech companies in NYC" in static/landing.html for better example clarity
- June 15, 2025. Landing page statistics update: Changed time savings metric from "22 Hours" / "Saved per Month" to "~48 Mins" / "Saved per Day" for more relatable daily value proposition
- June 15, 2025. First-time visitor authentication block removal: Eliminated immediate authentication modal for new users that was blocking the "try before you buy" experience. Removed shouldShowForFirstTimeUsers logic, hasVisitedBefore localStorage tracking, and cleaned up obsolete references. New users now get proper 14-second grace period to explore search functionality before authentication prompt
- June 15, 2025. Authentication delay extension: Increased semi-protected route authentication delay from 5 seconds to 14 seconds to give new users more time to explore and engage with search functionality before being prompted to register
- June 15, 2025. Company table URL click prevention: Modified company website URLs to be non-clickable text while keeping only the ExternalLink icon clickable. This prevents accidental URL clicks when users intend to expand company rows. Applied to both desktop and mobile views for consistent behavior
- June 15, 2025. Edge-to-edge mobile Companies Analysis layout: Changed root container padding from px-2 to px-0 on mobile devices (preserving md:px-6 for desktop) to eliminate the 8px left/right margins, allowing the Companies Analysis section to touch screen edges for maximum mobile space utilization
- June 15, 2025. Unified email deduplication system implementation: Created centralized email-utils.ts with mergeEmailData(), hasCompletedEmailSearch(), and normalizeEmail() functions. Replaced 6+ scattered email handling implementations across server/routes.ts with single source of truth, reducing code by ~65 lines. Added completion checks to Hunter.io, Apollo.io, AeroLeads, and Perplexity endpoints to prevent obsessive re-searching of contacts that already have emails. Fixed duplicate email bug where same email appeared in both primary and alternativeEmails fields due to race conditions between multiple search APIs
- June 15, 2025. Complete duplicate email fix implementation: Identified root cause as 160 contacts with same email in both primary and alternative fields from initial contact creation phase. Fixed with two-part solution: (1) Database cleanup removing duplicates from existing records using SQL array_remove function, (2) Prevention system with cleanContactData() function in email-utils.ts and integration into contact creation process in storage layer. Verified fix with zero remaining duplicates in database
- June 15, 2025. Comprehensive duplicate email fix finalization: Fixed additional 4 contacts with duplicates created after initial fix by identifying gap in mergeEmailData() function and missing deduplication in updateContact() method. Enhanced cleanContactData() with array checking, applied deduplication to contact updates in storage layer, and cleaned mergeEmailData() logic. Final verification shows zero duplicate emails in 2,875 total contacts. Prevention system now covers complete contact lifecycle (creation + updates + enrichment)
- June 15, 2025. Apollo email search prioritization: Moved Apollo.io search button (Rocket icon üöÄ) from last position to first position in ContactActionColumn component. Updated both desktop horizontal layout and mobile dropdown menu to prioritize Apollo as the primary email discovery service. New icon order: Eye ‚Üí Rocket ‚Üí Sparkles ‚Üí Target ‚Üí Gem. Change maintains all existing functionality, state management, and API integration while giving Apollo prominence in the user interface
- June 15, 2025. Waterfall email search backend prioritization: Reordered "Find Key Emails" backend search flow to prioritize Apollo.io as Phase 1 (was Phase 2), moved Perplexity to Phase 2 (was Phase 1), kept Hunter.io as Phase 3 final fallback. Simple code block reordering in server/routes.ts processCompany function without architectural changes or duplication. Apollo professional contact database now leads email discovery for higher business email success rates
- June 16, 2025. Parallel email search architecture implementation: Completely redesigned "Find Key Emails" backend from sequential waterfall to parallel execution strategy. Tier 1&2 run simultaneously with Apollo searching contacts 1&2 and Perplexity searching contacts 1&3 (contact #1 gets double coverage). Tier 3 Hunter only triggers if <1 email found total. Created helper functions searchApolloContacts(), searchPerplexityContacts(), searchHunterContacts() for multi-contact processing. Updated source breakdown tracking to handle combined results format. Performance improvement: ~40% faster execution with better contact coverage (all top 3 contacts vs previous uneven pattern). Maintains all existing error handling, deduplication, and API endpoints
- June 19, 2025. Critical credit billing system fix: Resolved bug where all search types were charged 10 credits regardless of user selection in search dialog. Implemented proper mapping function to convert frontend search types (companies/contacts/emails) to backend credit types with correct pricing: Companies Only (10 credits), Companies + Contacts (70 credits), Companies + Contacts + Emails (240 credits). Added new SearchType entries 'company_and_contacts' and 'company_contacts_emails' to credit system. Backend now accurately reads search type selection and bills accordingly, ensuring users pay the correct amount for their chosen search scope
- June 19, 2025. Credit system persistence migration: Replaced in-memory Map storage with direct Replit DB integration to prevent credit resets on server restart. Migrated all CreditService methods to use JSON serialization with 'user_credits:${userId}' key pattern. Added comprehensive error handling with graceful fallbacks for JSON parsing and DB operations. Credit data now persists across server restarts while maintaining identical API surface and all existing functionality. Created complete technical documentation in docs/credit-system.md covering architecture, pricing, API reference, troubleshooting, and admin operations
- June 19, 2025. Critical Replit DB response format bug identified: Discovered that Replit Database returns wrapped responses in format `{ ok: true, value: "JSON_STRING" }` for successful operations, but credit system code attempts to parse the entire wrapper object instead of extracting the `.value` property. This causes credits to show "Loading..." after initial creation since API returns `{ balance: undefined }`. Production logs confirm 180 credit creation succeeds but parsing fails due to malformed object structure. Root cause requires data extraction fix in CreditService.getUserCredits() method
- June 19, 2025. Credit display UI enhancement: Fixed credits display component to always show coin icons instead of warning triangles, and display actual balance numbers (including negative values like "-380") instead of generic "Blocked" text. Credit blocking system confirmed working correctly with 402 errors preventing searches when balance is negative. Enhanced user experience by showing precise credit deficit amounts while maintaining security through backend validation
- June 19, 2025. Complete Easter egg system implementation: Added scalable hidden bonus system with array-based tracking and case-insensitive triggers. Implemented three easter eggs: "5ducks" (1000 credits, ü¶Ü), "Free Palestine" (3000 credits, üáµüá∏), and "He is risen" (3000 credits, üêë). Frontend intercepts easter egg queries in search input before normal search execution, backend validates triggers case-insensitively, and system prevents duplicate claims through persistent array tracking format. Added dedicated `/api/credits/easter-egg` endpoint with secure validation, enhanced toast notifications with specific emoji and description display, and automatic credit refresh in UI
- June 20, 2025. Performance optimization: Implemented 1000ms debounced localStorage saving in home.tsx to reduce excessive I/O operations during typing. Changed from immediate save-on-keystroke to delayed save after user stops typing, reducing localStorage writes by ~90% while preserving all state restoration functionality
- June 20, 2025. Credits display simplification: Removed "Credits" text label from navigation credits display component, showing only coin icon and numeric value (e.g., "ü™ô 6,620" instead of "ü™ô 6,620 Credits") for cleaner, more compact UI
- June 20, 2025. Unified credit billing architecture: Fixed Perplexity individual email search erratic billing by removing backend HTTP billing and aligning with Apollo/Hunter/AeroLeads pattern. All four APIs now use consistent frontend billing through ContactActionColumn component, eliminating race conditions, timing delays, and parameter validation issues. Backend endpoints return contact data only while frontend handles pre-search validation and post-search billing. **Verified working:** Perplexity now consistently charges 20 credits per successful email discovery
- June 21, 2025. Complete guest-to-registered user search type upgrade system: Fixed authentication timing issue and implemented guest-to-registered transition handling. Added `hasEverBeenRegistered` localStorage flag to track registration status and automatically upgrade search type from "contacts" to "emails" when guests complete registration. Guest users default to "contacts" (70 credits, ~28 seconds), automatically upgrade to "emails" (240 credits, ~45 seconds) upon registration, while preserving all explicit user preferences. Optimizes guest conversion funnel with 38% faster initial results and seamless feature upgrade flow
- June 21, 2025. Complete notification system implementation: Built scalable user notification tracking using credit system array pattern. Added notifications array to UserCredits interface, created NotificationConfig registry, implemented CreditService notification methods (hasShownNotification, markNotificationShown, triggerNotification), added API endpoints (/api/notifications/trigger, /api/notifications/mark-shown), created NotificationToast component with badge support and markdown parsing, built useNotifications hook, and integrated "Hatchling" welcome notification on registration. System prevents duplicate notifications using proven Easter egg array tracking pattern while maintaining clean separation from localStorage
- June 21, 2025. Hatchling badge notification system completion: Fixed infinite loop issue in registration callback, implemented proper line break formatting in notification dialog (Email Search paragraph separation), and verified complete working flow. New users now receive polished welcome notification with Hatchling badge, proper text formatting, and "Chirp" button. System successfully tracks notification state and prevents duplicates across user sessions
- June 21, 2025. Complete guest-to-registered user migration system: Implemented comprehensive transition system that preserves user's original search query while providing clean starting point. On registration, system extracts guest search query BEFORE cleanup (critical timing fix), clears all localStorage data (searchState, contactSearchConfig, timestamps), restores query to input field, resets search button state (lastExecutedQuery, inputHasChanged) for blue button styling, invalidates saved searches cache to remove demo user lists, and shows encouraging toast message about upgraded search capabilities. Fixed data extraction timing issue where query was being extracted after localStorage was cleared. Prevents data ownership conflicts and provides seamless "try before you buy" to "full access" user experience with proper UI state
- June 22, 2025. Login button consistency fix: Added Login button to app page navigation when user is logged out, matching landing page design. Modified main-nav.tsx to show Login button (triggers registration modal) when no user authenticated, and show menu dropdown when user is logged in. Simple conditional logic change from `{user && (...)}` to proper if/else structure ensures consistent authentication access across all pages
- June 22, 2025. Button outline variant border removal: Removed border from outline button variant component-wide by updating button.tsx variant definition. Changed from `"border border-input bg-background hover:bg-accent hover:text-accent-foreground"` to `"bg-background hover:bg-accent hover:text-accent-foreground"`. Affects all outline buttons throughout the application for cleaner, borderless styling while maintaining background and hover effects
- June 22, 2025. Login button color consistency: Updated Login button text color to match navigation menu items by adding `text-muted-foreground hover:text-foreground` classes. Now uses same light grey color as "Search" and "Outreach" menu items for visual consistency across the navigation bar
- June 22, 2025. HTML landing page Login button border removal: Removed border styling from HTML landing page Login button to match React app borderless styling. Changed from `border border-slate-300 dark:border-slate-600` to borderless design while maintaining all other visual properties including hover effects and transitions
- June 22, 2025. Credits display color simplification: Simplified conditional colors to light yellow (text-yellow-500) for credits >= 1, red for zero/negative. Changed value label to dark grey (text-muted-foreground) to match navigation menu styling. Removed complex conditional logic with multiple color thresholds for cleaner, more consistent appearance
- June 22, 2025. Interactive credit upgrade dropdown implementation: Replaced static credits display with comprehensive upgrade dropdown featuring plan comparison, pricing, subscription management, and visual feedback. Component integrates with existing credit API, maintains all styling consistency, includes hover animations, dark mode support, and professional upgrade messaging. Credit balance remains clickable with enhanced user experience for easy plan selection and subscription management
- June 23, 2025. Complete Stripe webhook integration fix: Resolved Express middleware conflict preventing webhook signature verification. Fixed body parser order by applying express.raw() specifically to /api/stripe/webhook before express.json() middleware. Webhook now receives raw Buffer data for proper Stripe signature verification. Successfully tested automatic subscription activation: webhook processes subscription events, updates Replit DB with subscription status (active/canceled), awards 2,500 credits for "ugly-duckling" plan, and maintains complete subscription state persistence. Added STRIPE_TEST_SECRET and STRIPE_TEST_PUBLISH for development testing. Integration now fully automated from payment to credit allocation
- June 23, 2025. Stripe API version upgrade to 2025-05-28.basil: Updated Stripe client to latest API version for improved compatibility and new features. Simplified configuration to use same product ID (prod_SYHUcVegdfSjxn) and price ID (price_1RdAvpGfTiCdmxysMQt7i9FF) across both test and production environments. Implemented environment-based credential selection (test vs production keys) while maintaining unified price configuration. Fixed checkout session creation error by aligning environment detection logic across all Stripe components
- June 23, 2025. Complete webhook signature verification fix: Resolved webhook processing failure by identifying truncated STRIPE_WEBHOOK_SECRET (38 chars vs required 70 chars). Successfully activated user 388's subscription (sub_1RdCaWGfTiCdmxysxPdRJ7xi, customer cus_SYJCDUfzQ33Qjc) through manual webhook simulation, awarding 2,500 subscription credits. Webhook system confirmed working correctly once proper signing secret is configured. All future subscription payments will process automatically through established webhook flow (customer.subscription.created ‚Üí credit allocation ‚Üí subscription state updates)
- June 22, 2025. Delayed label animation for credit upgrade buttons: Implemented registration modal-style hover animation with 1-second delay and dual-span system. "Start Selling" transforms to "Let's Go üöÄ" and "Join Waitlist" becomes "Coming Soon üöÄ" using group hover classes and opacity/scale transitions matching the sophisticated registration flow
- June 22, 2025. Active subscription state implementation: Added Check icon import and enabled active state testing by setting currentPlan='ugly-duckling' and isSubscribed=true. Activated dormant green checkmark badge, green border styling, and "Current Plan" text replacement that were previously coded but never displayed due to null currentPlan state
- June 22, 2025. Interactive subscription state management: Converted hardcoded active state to dynamic React state with useState hooks. Reverted to inactive state (isSubscribed=false, currentPlan=null) and implemented click-to-activate functionality. Button clicks now trigger state changes that activate green checkmark, green border, "Current Plan" text, and update header text/subtext dynamically through existing getUpgradeText() and getUpgradeSubtext() functions
- June 22, 2025. Waitlist functionality implementation: Added differentiated behavior for "Join Waitlist" vs "Start Selling" buttons. Duckin' Awesome plan shows toast notification "Added to Waitlist" and button changes to "Added to Waitlist" text. Only The Ugly Duckling plan activates subscription state. Added waitlistPlans state tracking and useToast integration for professional user feedback
- June 22, 2025. Modern gradient CTA button implementation: Applied registration modal gradient styling to "Start Selling" button in credit upgrade dropdown. Changed from basic blue-600 background to sophisticated blue-to-purple gradient (from-blue-800 via-indigo-800 to-purple-800) with matching hover states, creating consistent premium button appearance across the application while maintaining existing hover scaling and shadow effects
- June 22, 2025. Credit dropdown button redesign: Updated "Start Selling" button to use search button gradient (cyan-to-blue: from-cyan-500 to-blue-500) for visual consistency. Changed "Duckin' Awesome" plan button to light grey background (bg-gray-200) with black hover state (hover:bg-black hover:text-white) and updated label from "Start Flying" to "Join Waitlist" for waitlist functionality
- June 22, 2025. Credit button hover enhancement: Reduced hover scaling from scale-105 to scale-102 for subtler effect. Added registration modal's delayed text animation - "Start Selling" transitions to "Let's Go üöÄ" after 1-second delay on hover, using absolute positioning with opacity transitions and group hover states for professional interactive feedback
- June 22, 2025. Credit dropdown upgrade logic fix: Updated isUpgrade logic to properly identify "Duckin' Awesome" plan as upgrade/waitlist plan regardless of current subscription status. Fixed button styling and label so premium plan always shows light grey background with black hover and "Join Waitlist" text
- June 22, 2025. Credit dropdown subtle refinements: Reduced card hover effects for more subtle interaction - changed scale from 1.02 to 1.01, shadow from hover:shadow-lg to hover:shadow-md, border opacity from 30% to 20%, and extended transition duration to 300ms. Lightened "Join Waitlist" button background from bg-gray-200 to bg-gray-100 for softer appearance
- June 22, 2025. Waitlist database tracking integration: Extended existing notification system to track waitlist members. Added notification ID 1 for "waitlist_joined" trigger with "Waitlist Member" badge. Users who join Duckin' Awesome waitlist now have notifications[1] = 1 in their credit record, enabling easy admin filtering and sorting of waitlist members using proven array tracking methodology
- June 22, 2025. Waitlist UI state persistence fix: Created dedicated /api/notifications/status endpoint separate from credits API to maintain security. Added NotificationStatus interface and useQuery hook to credit dropdown component. Implemented useEffect to sync UI waitlist state with database notifications array on page load, ensuring "Added to Waitlist" button state persists across browser refreshes while keeping credits API isolated from notification data
- June 22, 2025. Complete badges system implementation: Separated badges from notifications by adding dedicated badges array to UserCredits interface. Created BadgeConfig interface and BADGES registry, moved Hatchling badge (ID 0) from notifications to badges tracking system. Implemented badge-specific methods (hasEarnedBadge, awardBadge, triggerBadge) and enhanced API endpoints to handle both notification and badge workflows. Updated frontend to display and track badges correctly, ensuring Hatchling badge persists properly as permanent achievement while notifications remain temporary
- June 22, 2025. Credit dropdown overlay unification: Updated credit upgrade dropdown overlay from bg-black/20 to bg-black/80 to match unified design system used by Dialog, AlertDialog, and Sheet components throughout application. Maintained original DropdownMenu positioning while adding semi-transparent overlay for consistent visual experience across all modal interactions
- June 22, 2025. Badge system cleanup: Removed automatic migration logic and unnecessary hasHatchlingBadge field from API responses. System now uses clean badge tracking without backward compatibility. New users receive proper Hatchling badge (ID 0) on registration, existing users continue with their current state
- June 22, 2025. Persistent tooltip tracking system: Implemented dual-tracking solution for "show once" tooltips that preserves guest user functionality while adding persistent tracking for authenticated users. Added notification IDs 2 (search_tooltip_shown) and 3 (email_tooltip_shown) to notifications array. Search button tooltip from landing page continues working for guests, while authenticated users get persistent "already shown" status. Email discovery tooltip (5 seconds after first search) now persists for authenticated users instead of resetting each session. Uses existing notification infrastructure without duplication
- June 22, 2025. Complete tooltip system unification: Added notification ID 4 (start_selling_tooltip_shown) to complete the tooltip tracking system. "Start Selling" tooltip that appears after "Find Key Emails" completion now follows same pattern as other tooltips - shows every time for guests, shows once for authenticated users with persistent tracking. All four tooltips (search button, email discovery, start selling) now use unified notification array tracking system with consistent dual-behavior for guest vs authenticated users
- June 22, 2025. Unified tooltip dismissal behavior: Added 'dismissTooltip' event listener to home.tsx enabling click-to-dismiss functionality for Email Discovery and Start Selling tooltips. Both tooltips now respond to clicks by immediately dismissing, marking as shown in database for authenticated users, and preventing future displays. Behavior now matches search button tooltip pattern with immediate persistence on click rather than only timer-based dismissal
- June 22, 2025. Start Selling tooltip duration optimization: Reduced auto-dismiss timer from 25 seconds to 10 seconds for better user experience consistency with other tooltips in the system
- June 22, 2025. Guest authentication delay extension: Increased semi-protected route authentication delay from 14 seconds to 25 seconds to provide guests more exploration time before registration prompt, enhancing "try before you buy" experience
- June 22, 2025. Guest authentication delay extension: Increased guest user registration prompt delay from 14 seconds to 25 seconds to provide more time for evaluation of search functionality before authentication requirement


## User Preferences

Preferred communication style: Simple, everyday language.
Mobile UI preference: Compact, space-efficient design with seamless header-to-content transitions.